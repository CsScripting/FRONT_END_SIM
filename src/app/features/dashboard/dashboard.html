<div class="content-header">
  <div class="header-left-content">
    <h1>Dashboard</h1>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">Home</a></li>
      <li class="breadcrumb-item active">Dashboard</li>
    </ol>
  </div>
</div>

<ng-container *ngIf="currentUser$ | async as user">

  <!-- Prompt for Staff users with no filters -->
  <div *ngIf="user.is_staff && !hasActiveFilters()" class="no-content prompt">
    <i class="fas fa-check-square"></i>
    <p>No Connections Activated</p>
    <span>Please go to <a routerLink="/clients">Clients</a>, then <a routerLink="/environments-admin">Environments</a> to activate the connections you want to see here.</span>
  </div>

  <!-- Main Dashboard View -->
  <ng-container *ngIf="environmentGroups$ | async as groups">
    <div class="dashboard-container" *ngIf="!user.is_staff || hasActiveFilters()">
    
      <header class="dashboard-header">
        <button *ngIf="selectedGroup()" (click)="goBack()" class="back-button">
          <i class="fas fa-arrow-left"></i> Back to Groups
        </button>
        <h2>{{ selectedGroup() ? 'Connections for ' + selectedGroup() : 'Available Connection Groups' }}</h2>
      </header>

      <!-- Group View -->
      <main class="environments-grid" *ngIf="!selectedGroup()">
        <div class="environment-card group-card" *ngFor="let group of groups | keyvalue" (click)="onSelectGroup(group.key, groups)">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
            </svg>
          </div>
          <div class="card-content">
            <h2 class="client-name">{{ group.key }}</h2>
            <p class="environment-name">{{ group.value.length }} connection(s)</p>
          </div>
        </div>
        <div *ngIf="(groups | keyvalue).length === 0 && hasActiveFilters()" class="no-environments">
            <p>No connections match the current filter criteria.</p>
        </div>
      </main>
      
      <!-- Environments within Group View -->
      <main class="environments-grid" *ngIf="selectedGroup()">
        <div class="environment-card" *ngFor="let env of groupEnvironments()" (click)="onSelectEnvironment(env)">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h4.5M15 3h4.5a2.25 2.25 0 012.25 2.25" />
            </svg>
          </div>
          <div class="card-content">
            <h2 class="client-name">{{ env.client_name }}</h2>
            <p class="environment-name">{{ env.name }}</p>
            <span class="status" [class.active]="env.is_active">
              {{ env.is_active ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
      </main>
      
      <ng-template #loading>
        <p class="loading-text">Loading connections...</p>
      </ng-template>
    </div>
  </ng-container>

</ng-container>
